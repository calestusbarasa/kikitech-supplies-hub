<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Order - Kikitech Supplies</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
/* Base styles */
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #a8edea, #fed6e3); /* pastel teal + pink */
  color: #333;
}

/* Container with glass effect */
.container {
  max-width: 1050px;
  margin: 30px auto;
  padding: 30px;
  background: rgba(255, 255, 255, 0.88);
  border-radius: 18px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
  backdrop-filter: blur(12px);
}

/* Header */
.header {
  text-align: center;
  margin-bottom: 25px;
}
.header img {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  object-fit: cover;
  margin-bottom: 10px;
}
.header h1 {
  margin: 5px 0;
  color: #007b5e;
}
.tagline {
  font-style: italic;
  color: #444;
}
.contact {
  font-size: 0.95em;
  color: #555;
}

/* Top navigation buttons */
.top-nav {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-bottom: 25px;
}
.top-nav a {
  background: linear-gradient(135deg, #007b5e, #009f7f);
  color: white;
  padding: 10px 18px;
  border-radius: 12px;
  text-decoration: none;
  font-size: 0.95em;
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  transition: 0.3s ease;
}
.top-nav a:hover {
  background: linear-gradient(135deg, #005f4a, #008c6b);
  transform: translateY(-2px);
}

/* Form styling */
form label {
  font-weight: bold;
  display: block;
  margin-top: 15px;
  margin-bottom: 5px;
  color: #333;
}
form input[type="text"], form select {
  width: 100%;
  padding: 12px 14px;
  font-size: 1em;
  border-radius: 10px;
  border: none;
  background: rgba(255,255,255,0.7);
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.1);
  transition: border 0.3s ease, box-shadow 0.3s ease;
}
form input:focus, form select:focus {
  outline: none;
  border: 2px solid #007b5e;
  box-shadow: 0 0 6px rgba(0,123,94,0.4);
}

/* Table */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  font-size: 0.95em;
  background: rgba(255,255,255,0.9);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0,0,0,0.15);
}
th, td {
  padding: 12px;
  border-bottom: 1px solid rgba(0,0,0,0.1);
  text-align: center;
}
th {
  background: #007b5e;
  color: white;
}
tr:nth-child(even) {
  background: rgba(0, 123, 94, 0.05);
}
tr:hover {
  background: rgba(0, 123, 94, 0.15);
}

/* Table inputs/selects */
table select, 
table input {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid rgba(0,0,0,0.2);
  background: rgba(255,255,255,0.9);
  font-size: 0.95em;
}
table input[readonly] {
  background: rgba(240,240,240,0.8);
  color: #333;
}

/* Remove button */
.remove-btn {
  cursor: pointer;
  color: #c0392b;
  font-size: 1.2em;
  transition: 0.3s;
}
.remove-btn:hover {
  color: #e74c3c;
}

/* Buttons */
button {
  margin-top: 20px;
  padding: 12px 20px;
  font-weight: bold;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  background: linear-gradient(135deg, #007b5e, #009f7f);
  color: white;
  font-size: 1em;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  box-shadow: 0 6px 15px rgba(0,123,94,0.3);
  transition: 0.3s ease;
}
button:hover {
  background: linear-gradient(135deg, #005f4a, #008c6b);
  transform: translateY(-2px);
}
#addProductBtn {
  background: linear-gradient(135deg, #28a745, #34ce57);
}
#addProductBtn:hover {
  background: linear-gradient(135deg, #1e7e34, #28a745);
}

/* Responsive */
@media (max-width: 700px) {
  .container {
    margin: 15px;
    padding: 20px;
  }
  .top-nav {
    flex-direction: column;
    gap: 12px;
  }
  table {
    font-size: 0.85em;
  }
}
  </style>
</head>
<body>
  <div class="container">
    <!-- Logo & Header -->
    <div class="header">
      <img src="/static/logo.png" alt="Kikitech Logo">
      <h1>Kikitech Supplies</h1>
      <p class="tagline">"Let's glam your house"</p>
      <p class="contact"><i class="fas fa-phone"></i> +254796813752 &nbsp; | &nbsp; 
        <i class="fas fa-envelope"></i> info@kikitechsupplies.co.ke</p>
    </div>

    <!-- Top Navigation -->
    <div class="top-nav">
      {% if session['role'] == 'admin' %}
        <a href="{{ url_for('dashboard') }}"><i class="fas fa-tachometer-alt"></i> Admin Dashboard</a>
      {% elif session['role'] == 'user' %}
        <a href="{{ url_for('mydashboard') }}"><i class="fas fa-user"></i> My Dashboard</a>
      {% endif %}
      <a href="{{ url_for('view_products') }}"><i class="fas fa-boxes"></i> Products</a>
    </div>

    <!-- Add Sale Form -->
    <h2 style="text-align:center; color:#007b5e;">Add Sale</h2>
    <form method="POST">
      <label for="customer_name">Customer Name:</label>
      <input type="text" id="customer_name" name="customer_name" required>

      <label for="payment_mode">Payment Mode:</label>
      <select id="payment_mode" name="payment_mode" required>
        <option value="Cash">Cash</option>
        <option value="Mpesa">Mpesa</option>
        <option value="Bank">Bank</option>
      </select>

      <table id="productsTable">
        <thead>
          <tr>
            <th>Product</th>
            <th>Description</th>
            <th>Qty</th>
            <th>Price</th>
            <th>Total</th>
            <th>✖</th>
          </tr>
        </thead>
        <tbody>
          <!-- Rows added by JS -->
        </tbody>
      </table>

      <button type="button" id="addProductBtn" onclick="addProductRow()">
        <i class="fas fa-plus"></i> Add Product
      </button>

      <h3>Grand Total: KES <span id="grandTotal">0.00</span></h3>

      <button type="submit"><i class="fas fa-paper-plane"></i> Submit Order</button>
    </form>
  </div>

  <script>
    function addProductRow() {
      const table = document.getElementById("productsTable").getElementsByTagName("tbody")[0];
      const row = table.insertRow();
      row.innerHTML = `
        <td>
          <select name="product_id[]" required onchange="updateDescription(this)">
            <option value="">--Select--</option>
            {% for product in products %}
              <option value="{{ product.id }}" data-description="{{ product.description }}">
                {{ product.name }} ({{ product.description }}) [{{ product.quantity }}]
              </option>
            {% endfor %}
          </select>
        </td>
        <td class="description-cell">—</td>
        <td><input type="number" name="quantity[]" min="1" required oninput="calculateTotal(this)"></td>
        <td><input type="number" name="price[]" min="0" step="0.01" required oninput="calculateTotal(this)"></td>
        <td><input type="number" name="item_total[]" readonly></td>
        <td><span class="remove-btn" onclick="removeRow(this)"><i class="fas fa-trash"></i></span></td>
      `;
    }

    function updateDescription(selectElement) {
      const desc = selectElement.options[selectElement.selectedIndex].dataset.description;
      const row = selectElement.closest("tr");
      row.querySelector(".description-cell").innerText = desc || '—';
    }

    function removeRow(btn) {
      btn.closest("tr").remove();
      updateGrandTotal();
    }

    function calculateTotal(el) {
      const row = el.closest("tr");
      const qty = parseFloat(row.querySelector('input[name="quantity[]"]').value) || 0;
      const price = parseFloat(row.querySelector('input[name="price[]"]').value) || 0;
      const total = qty * price;
      row.querySelector('input[name="item_total[]"]').value = total.toFixed(2);
      updateGrandTotal();
    }

    function updateGrandTotal() {
      let grand = 0;
      document.querySelectorAll('input[name="item_total[]"]').forEach(input => {
        grand += parseFloat(input.value) || 0;
      });
      document.getElementById("grandTotal").innerText = grand.toFixed(2);
    }

    window.onload = addProductRow;
  </script>
</body>
</html>